#!/usr/bin/env bash
set -euo pipefail

# === Banner ===
cat <<'BANNER'
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@%-----------------------------------------------%@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:+##############%############################+:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@@@@@@@#+=:::::::::::::-+#@@@@@@@@@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@@@#=:::::::::::::::::::::::=#@@@@@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@+:::::::::::::::::::::::::::::=%@@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@=:::::::::::::::::::::::::::::::::-@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@#:::::::::::::::::::::::::::::::::::::*@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@+:::::::::::::::::::::::::::::::::::::::=@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@#::::::*@@@@@@+:::::::::::-%@@@@@#::::::*@*:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:**+@@:=@@@@%@@@@@@@=::::::%@@@@@@%@@@@+:*@*+*:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@-*-::::::=@@@@@@=::%@@@@@+::::::-*-@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*%%@@-::::::::::=@@@@-::%@@@*:::::::::::@@%##:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@%-::*=:::+#%%#=:--::::::-:-#%@%*:::-#::-#@#:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:**::::#=::@@@@@@@%::=-::+::*@@@@@@@-:-%::::+#:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:**:::::::##+=+*@@#::+-::*::*@@#+=+*%-::::::+#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:**:::::-:::::::::::=#:::*+:::::::::::-:::::+#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:**:::*@+:::::::::-#:::::::*=:::::::::=@#:::+#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*#:-@@@-:::::::::#:::::::::#::::::::::%@@-:+#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*#:*@@@+::::::-*@@@%-::::#@@@*-::::::=@@@#:*#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@:*@@@@@@#@@@@@@@@@@@#@@@@@@@@@@@%%@@@@@%:%#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@-@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=%@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@#:#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%:#@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@::-=#@@@@%#+==%@@@@@#=++*%@@@@#+-::%@@@#:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@#::::::::=@@@@@@%%%@@@@@@*::::::::*@@@@#:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@-:::::::::-#@@@@@@@@@%+:::::::::-@@@@@#:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@#::::::::::::::---::::::::::::::*@@@@@#:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@-:::::::::::::::::::::::::::::-@@@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@@=:::::::::::::::::::::::::::=@@@@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@@@%-:::::::::::::::::::::::-%@@@@@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@@@@@@-:::::::::::::::::::-@@@@@@@@@@@#:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@@@@@@@#:::::::::::::::::#@@@@@@@@@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:*@@@@@@@@@@@@@@@#+*%@@@@@%*+*@@@@@@@@@@@@@@@#:#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:::::::::::::::::::::::::::::::::::::::::::::::#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:=@+:%@:*@@@%:+@@@%:-@@@@=-@*=@@@%=@@@@=%@:*@-:*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:=@+:%@:%%:==-@@:=@*#@--#*-@*=@+::::@%::=@#@*::*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:=@@@@@:-%@#::@@:+@*#@-:::-@*=@@@#::@%:::%@@-::*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:=@+:%@:=-:%@-@@:+@*#@--#*-@*=@+::::@@:::-@#:::*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:=@+:%@:%@%@@-*@%@@-=@@%@+-@*=@@@@::@%:::-@#:::*@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@#:::::::::::::::::::::::::::::::::::::::::::::::#@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@##******#*********************#################@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
          HSociety Recon Toolkit âš¡
BANNER

if [[ $# -lt 1 ]]; then
  echo "Usage: $0 <domain>"
  exit 1
fi

DOMAIN="$1"
TS="$(date +"%Y%m%d-%H%M%S")"
OUTDIR="recon_${DOMAIN}_${TS}"
mkdir -p "$OUTDIR"

log() { echo -e "[\e[32m$(date +%H:%M:%S)\e[0m] $*"; }

log "ðŸš€ Starting recon on $DOMAIN"
echo "Results will be saved in $OUTDIR/"

# === WHOIS ===
log "ðŸ”Ž Collecting WHOIS info..."
whois "$DOMAIN" > "$OUTDIR/whois.txt" 2>/dev/null || true

# === DNS Records ===
log "ðŸŒ Collecting DNS records..."
{
  echo "A records:"; dig +short A "$DOMAIN"
  echo -e "\nAAAA records:"; dig +short AAAA "$DOMAIN"
  echo -e "\nNS records:"; dig +short NS "$DOMAIN"
  echo -e "\nMX records:"; dig +short MX "$DOMAIN"
  echo -e "\nTXT records:"; dig +short TXT "$DOMAIN"
} > "$OUTDIR/dns.txt"

# === Subdomains ===
WORDLIST="/usr/share/wordlists/dirb/common.txt"
if [[ -f "$WORDLIST" ]]; then
  log "ðŸŒª Brute forcing subdomains (parallelized)..."
  > "$OUTDIR/subdomains.txt"
  grep -v '^\.' "$WORDLIST" | grep -v '^#' | grep -v '^[[:space:]]*$' | \
    xargs -I{} -P 50 bash -c '
      host="{}.'"$DOMAIN"'"
      if dig +short "$host" >/dev/null; then
        echo "$host"
      fi
    ' >> "$OUTDIR/subdomains.txt"
else
  log "âš ï¸  Wordlist not found at $WORDLIST, skipping subdomain brute force."
fi

# === Resolve Subdomains ===
if [[ -s "$OUTDIR/subdomains.txt" ]]; then
  log "ðŸŒ Resolving discovered subdomains..."
  while read -r s; do
    ip=$(dig +short A "$s" | head -n1)
    [[ -n "$ip" ]] && echo "$s -> $ip"
  done < "$OUTDIR/subdomains.txt" > "$OUTDIR/resolved.txt"
fi

# === Nmap Scan ===
log "ðŸ›° Running Nmap top 1000 ports (fast mode)..."
nmap -T4 -Pn --top-ports 1000 -sV -oN "$OUTDIR/nmap.txt" "$DOMAIN" || true

# === TLS Certificate ===
log "ðŸ” Fetching TLS certificate info..."
echo | timeout 5 openssl s_client -servername "$DOMAIN" -connect "$DOMAIN:443" 2>/dev/null \
  | openssl x509 -noout -issuer -subject -dates -ext subjectAltName > "$OUTDIR/tls.txt" || true

# === Robots & Headers ===
for SCHEME in http https; do
  log "ðŸ“‘ Fetching headers and robots.txt for $SCHEME://$DOMAIN"
  {
    echo "===== $SCHEME://$DOMAIN ====="
    curl -s -m 5 -I "$SCHEME://$DOMAIN" || true
    echo -e "\nRobots:"
    curl -s -m 5 "$SCHEME://$DOMAIN/robots.txt" | head -n 200 || echo "No robots.txt"
  } > "$OUTDIR/${SCHEME}_info.txt"
done

log "âœ… Recon complete. Artifacts saved in $OUTDIR/"
